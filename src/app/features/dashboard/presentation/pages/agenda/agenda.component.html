<div class="agenda-container">
  <div class="agenda-header">
    <mat-icon>event</mat-icon>
    <h1>{{ 'AGENDA.TITLE' | translate }}</h1>
  </div>

  <div class="loading-section" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>{{ 'AGENDA.LOADING' | translate }}</p>
  </div>

  <div class="error-section" *ngIf="error && !loading">
    <mat-icon>error_outline</mat-icon>
    <h3>{{ 'AGENDA.ERROR_TITLE' | translate }}</h3>
    <p>{{ 'AGENDA.ERROR_MESSAGE' | translate }}</p>
    <button mat-raised-button color="primary" (click)="loadAgendaItems()">
      {{ 'AGENDA.RETRY' | translate }}
    </button>
  </div>

  <div class="agenda-content" *ngIf="!loading && !error">
    <!-- Native Calendar Implementation -->
    <div class="native-calendar">
      <div class="calendar-header">
        <button mat-icon-button (click)="previousMonth()">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <h2>{{ formatMonthYear(currentDate) }}</h2>
        <button mat-icon-button (click)="nextMonth()">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
      
      <button mat-flat-button color="primary" (click)="goToToday()" class="today-button">
        {{ 'AGENDA.TODAY' | translate }}
      </button>

      <div class="calendar-grid">
        <!-- Week days header -->
        <div class="calendar-week-header">
          <div class="calendar-day-header" *ngFor="let day of weekDays">{{ day }}</div>
        </div>
        
        <!-- Calendar days -->
        <div class="calendar-days">
          <div 
            class="calendar-day" 
            *ngFor="let day of calendarDays"
            [class.current-month]="isCurrentMonth(day)"
            [class.today]="isToday(day)"
            (click)="viewDate = day"
          >
            <span class="day-number">{{ formatDate(day) }}</span>
            <div class="day-events">
              <div 
                class="event-card" 
                *ngFor="let event of getEventsForDate(day)"
                [style.backgroundColor]="event.color?.primary"
                (click)="eventClicked(event); $event.stopPropagation()"
                [title]="event.title"
              >
                <span class="event-title">{{ event.title }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Angular Calendar Implementation (commented out for now) -->
    <!--
    <div class="calendar-controls">
      <div class="calendar-actions">
        <button mat-icon-button (click)="previous()">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button mat-flat-button (click)="today()">
          {{ 'AGENDA.TODAY' | translate }}
        </button>
        <button mat-icon-button (click)="next()">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
      <div class="calendar-view-header">
        <h2>{{ viewDate | date:'MMMM yyyy' }}</h2>
      </div>
      <div class="view-toggle-buttons">
        <button
          mat-button
          (click)="setView(CalendarView.Month)"
          [class.active]="view === CalendarView.Month"
        >
          {{ 'AGENDA.MONTH' | translate }}
        </button>
        <button
          mat-button
          (click)="setView(CalendarView.Week)"
          [class.active]="view === CalendarView.Week"
        >
          {{ 'AGENDA.WEEK' | translate }}
        </button>
        <button
          mat-button
          (click)="setView(CalendarView.Day)"
          [class.active]="view === CalendarView.Day"
        >
          {{ 'AGENDA.DAY' | translate }}
        </button>
      </div>
    </div>

    <div [ngSwitch]="view">
      <mwl-calendar-month-view
        *ngSwitchCase="CalendarView.Month"
        [viewDate]="viewDate"
        [events]="agendaEvents"
        [locale]="translate.currentLang"
        (eventClick)="eventClicked($event)"
      >
        <ng-template #mwlCalendarEventTemplate let-event="event">
          <div class="cal-event-custom" [style.backgroundColor]="event.color?.primary" [style.borderColor]="event.color?.secondary" (click)="eventClicked(event)">
            <div class="cal-event-title">{{ event.title }}</div>
            <div *ngIf="event.meta?.description" class="cal-event-description">{{ event.meta.description }}</div>
            <div *ngIf="event.meta?.location" class="cal-event-location">{{ event.meta.location }}</div>
          </div>
        </ng-template>
      </mwl-calendar-month-view>

      <mwl-calendar-week-view
        *ngSwitchCase="CalendarView.Week"
        [viewDate]="viewDate"
        [events]="agendaEvents"
        [locale]="translate.currentLang"
        (eventClick)="eventClicked($event)"
      >
        <ng-template #mwlCalendarEventTemplate let-event="event">
          <div class="cal-event-custom" [style.backgroundColor]="event.color?.primary" [style.borderColor]="event.color?.secondary" (click)="eventClicked(event)">
            <div class="cal-event-title">{{ event.title }}</div>
            <div *ngIf="event.meta?.description" class="cal-event-description">{{ event.meta.description }}</div>
            <div *ngIf="event.meta?.location" class="cal-event-location">{{ event.meta.location }}</div>
          </div>
        </ng-template>
      </mwl-calendar-week-view>

      <mwl-calendar-day-view
        *ngSwitchCase="CalendarView.Day"
        [viewDate]="viewDate"
        [events]="agendaEvents"
        [locale]="translate.currentLang"
        (eventClick)="eventClicked($event)"
      >
        <ng-template #mwlCalendarEventTemplate let-event="event">
          <div class="cal-event-custom" [style.backgroundColor]="event.color?.primary" [style.borderColor]="event.color?.secondary" (click)="eventClicked(event)">
            <div class="cal-event-title">{{ event.title }}</div>
            <div *ngIf="event.meta?.description" class="cal-event-description">{{ event.meta.description }}</div>
            <div *ngIf="event.meta?.location" class="cal-event-location">{{ event.meta.location }}</div>
          </div>
        </ng-template>
      </mwl-calendar-day-view>
    </div>
    -->

    <div *ngIf="agendaEvents.length === 0 && !loading" class="empty-state no-events">
      <mat-icon class="empty-icon">event_busy</mat-icon>
      <h3>{{ 'AGENDA.EMPTY_TITLE' | translate }}</h3>
      <p>{{ 'AGENDA.EMPTY_MESSAGE' | translate }}</p>
    </div>
  </div>
</div> 