<div class="profile-container">
  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <h2 class="loading-text">Cargando perfil...</h2>
    <p class="loading-subtitle">Obteniendo tu información personal</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h2 class="error-title">Error al cargar el perfil</h2>
    <p class="error-message">No se pudo cargar la información del perfil. Verifica tu conexión e intenta nuevamente.</p>
    <button class="retry-button" (click)="loadUserProfile()">
      <mat-icon>refresh</mat-icon>
      Reintentar
    </button>
  </div>

  <!-- Perfil cargado -->
  <div *ngIf="user && !loading && !error" class="profile-content">
    <!-- Header del perfil -->
    <div class="profile-header">
      <div class="avatar-container">
        <div
          class="avatar"
          [style.backgroundImage]="getProfileImage() ? 'url(' + getProfileImage() + ')' : ''"
        >
          <mat-icon *ngIf="!getProfileImage()">person</mat-icon>
        </div>
      </div>
      <div class="user-info">
        <h1>{{ user.name }}</h1>
        <span class="user-type">{{ isInfluencer() ? "Influencer" : "Marca" }}</span>
        <p class="location" *ngIf="hasValue(user.location)">
          <mat-icon>location_on</mat-icon> {{ user.location }}
        </p>
      </div>
      <div class="actions">
        <button class="edit-button">
          <mat-icon>edit</mat-icon>
          Editar Perfil
        </button>
      </div>
    </div>

    <!-- Bio/Descripción -->
    <section class="profile-section" *ngIf="hasValue(user.bio) || hasValue(user.description)">
      <h2>{{ isInfluencer() ? 'Biografía' : 'Descripción' }}</h2>
      <p class="bio">{{ user.bio || user.description }}</p>
    </section>

    <!-- Información específica para Influencers -->
    <ng-container *ngIf="isInfluencer()">
      <section class="profile-section" *ngIf="hasValue(user.followers) || hasValue(user.niches)">
        <h2>Información de Influencer</h2>

        <div class="stats-grid" *ngIf="hasValue(user.followers)">
          <div class="stat-card">
            <div class="stat-value">
              {{ formatFollowers(user.followers!) }}
            </div>
            <div class="stat-label">Seguidores</div>
          </div>
        </div>

        <div class="detail-grid" *ngIf="hasValue(user.niches)">
          <div class="detail-item">
            <span class="detail-label">Nichos:</span>
            <span class="detail-value">{{ user.niches!.join(', ') }}</span>
          </div>
        </div>
      </section>
    </ng-container>

    <!-- Información específica para Marcas -->
    <ng-container *ngIf="isBrand()">
      <section class="profile-section" *ngIf="hasValue(user.sector) || hasValue(user.websiteUrl)">
        <h2>Información de Marca</h2>

        <div class="detail-grid">
          <div class="detail-item" *ngIf="hasValue(user.sector)">
            <span class="detail-label">Sector:</span>
            <span class="detail-value">{{ user.sector }}</span>
          </div>

          <div class="detail-item" *ngIf="hasValue(user.websiteUrl)">
            <span class="detail-label">Sitio Web:</span>
            <span class="detail-value">
              <a [href]="user.websiteUrl" target="_blank" class="link-item">{{ user.websiteUrl }}</a>
            </span>
          </div>
        </div>
      </section>
    </ng-container>

    <!-- Enlaces -->
    <section class="profile-section" *ngIf="user.links && user.links.length > 0">
      <h2>Enlaces</h2>
      <div class="links-grid">
        <a
          *ngFor="let link of user.links"
          [href]="link.url"
          target="_blank"
          class="link-item"
        >
          <mat-icon>link</mat-icon>
          <span>{{ link.title }}</span>
        </a>
      </div>
    </section>

    <!-- Redes Sociales -->
    <section class="profile-section" *ngIf="getSocialLinks().length > 0">
      <h2>Redes Sociales</h2>
      <div class="social-links">
        <a
          *ngFor="let social of getSocialLinks()"
          [href]="social.url"
          target="_blank"
          class="social-link"
        >
          <mat-icon>{{ social.icon }}</mat-icon>
          <span>{{ social.platform | titlecase }}</span>
        </a>
      </div>
    </section>

    <!-- Adjuntos -->
    <section class="profile-section" *ngIf="user.attachments && user.attachments.length > 0">
      <h2>Archivos Adjuntos</h2>
      <div class="attachments-grid">
        <div
          *ngFor="let attachment of user.attachments"
          class="attachment-item"
        >
          <!-- Vista previa de imagen -->
          <div *ngIf="isImage(attachment.mediaType)" class="attachment-preview">
            <img 
              [src]="getAttachmentUrl(attachment)" 
              [alt]="attachment.title"
              class="preview-image"
              (click)="downloadAttachment(attachment)"
            />
            <div class="preview-overlay">
              <mat-icon>zoom_in</mat-icon>
            </div>
          </div>

          <!-- Vista previa de video -->
          <div *ngIf="isVideo(attachment.mediaType)" class="attachment-preview">
            <video 
              [src]="getAttachmentUrl(attachment)" 
              class="preview-video"
              controls
              preload="metadata"
            >
              Tu navegador no soporta el elemento de video.
            </video>
            <div class="video-overlay">
              <mat-icon>play_circle</mat-icon>
            </div>
          </div>

          <!-- Vista previa de documento -->
          <div *ngIf="isDocument(attachment.mediaType)" class="attachment-preview">
            <div class="document-preview" (click)="downloadAttachment(attachment)">
              <mat-icon class="document-icon">{{ getAttachmentIcon(attachment.mediaType) }}</mat-icon>
              <div class="document-info">
                <h4>{{ attachment.title }}</h4>
                <p *ngIf="hasValue(attachment.description)">{{ attachment.description }}</p>
                <span class="document-type">{{ getDocumentType(attachment.title) }}</span>
              </div>
              <mat-icon class="download-icon">download</mat-icon>
            </div>
          </div>

          <!-- Información del adjunto -->
          <div class="attachment-info">
            <h4>{{ attachment.title }}</h4>
            <p *ngIf="hasValue(attachment.description)">{{ attachment.description }}</p>
            <div class="attachment-actions">
              <button 
                class="action-button view-button" 
                (click)="downloadAttachment(attachment)"
                *ngIf="!isVideo(attachment.mediaType)"
              >
                <mat-icon>visibility</mat-icon>
                Ver
              </button>
              <button 
                class="action-button download-button" 
                (click)="downloadAttachment(attachment)"
              >
                <mat-icon>download</mat-icon>
                Descargar
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Información de Fechas -->
  
  </div>
</div>
