<div class="onboarding-container">
  <div class="onboarding-content">
    <h1>{{ (isBrand ? 'ONBOARDING.BRAND_TITLE' : 'ONBOARDING.INFLUENCER_TITLE') | translate }}</h1>
    <p class="subtitle">{{ (isBrand ? 'ONBOARDING.BRAND_SUBTITLE' : 'ONBOARDING.INFLUENCER_SUBTITLE') | translate }}</p>

    <form [formGroup]="form" (ngSubmit)="submit()" class="profile-form">
      <!-- Basic Information -->
      <div class="form-group">
        <label>{{ 'ONBOARDING.NAME' | translate }}</label>
        <input type="text" formControlName="name" required>
        <div class="error-message" *ngIf="form.get('name')?.hasError('required')">
          {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
        </div>
      </div>

      <div class="form-group">
        <label>{{ 'ONBOARDING.DESCRIPTION' | translate }}</label>
        <textarea formControlName="description" rows="4" required></textarea>
        <div class="error-message" *ngIf="form.get('description')?.hasError('required')">
          {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
        </div>
      </div>

      <div class="form-group">
        <label>{{ 'ONBOARDING.COUNTRY' | translate }}</label>
        <input type="text" formControlName="country" required>
        <div class="error-message" *ngIf="form.get('country')?.hasError('required')">
          {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
        </div>
      </div>

      <div class="form-group">
        <label>{{ 'ONBOARDING.LOCATION' | translate }}</label>
        <input type="text" formControlName="location" required>
        <div class="error-message" *ngIf="form.get('location')?.hasError('required')">
          {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
        </div>
      </div>

      <!-- Brand specific fields -->
      <ng-container *ngIf="isBrand">
        <div class="form-group">
          <label>{{ 'ONBOARDING.SECTOR' | translate }}</label>
          <input type="text" formControlName="sector" required>
          <div class="error-message" *ngIf="form.get('sector')?.hasError('required')">
            {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
          </div>
        </div>

        <div class="form-group">
          <label>{{ 'ONBOARDING.WEBSITE' | translate }}</label>
          <input type="url" formControlName="websiteUrl" required>
          <div class="error-message" *ngIf="form.get('websiteUrl')?.hasError('required')">
            {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
          </div>
          <div class="error-message" *ngIf="form.get('websiteUrl')?.hasError('pattern')">
            {{ 'ONBOARDING.INVALID_URL' | translate }}
          </div>
        </div>
      </ng-container>

      <!-- Influencer specific fields -->
      <ng-container *ngIf="!isBrand">
        <div class="form-group">
          <label>{{ 'ONBOARDING.NICHES' | translate }}</label>
          <mat-form-field class="full-width">
            <mat-select multiple formControlName="niches" required>
              <mat-option value="Moda">Moda</mat-option>
              <mat-option value="Lifestyle">Lifestyle</mat-option>
              <mat-option value="Viajes">Viajes</mat-option>
              <mat-option value="Belleza">Belleza</mat-option>
              <mat-option value="Fitness">Fitness</mat-option>
              <mat-option value="Comida">Comida</mat-option>
              <mat-option value="Tecnología">Tecnología</mat-option>
              <mat-option value="Gaming">Gaming</mat-option>
              <mat-option value="Música">Música</mat-option>
              <mat-option value="Deportes">Deportes</mat-option>
            </mat-select>
            <div class="error-message" *ngIf="form.get('niches')?.hasError('required')">
              {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
            </div>
          </mat-form-field>
        </div>

        <div class="form-group">
          <label>{{ 'ONBOARDING.FOLLOWERS' | translate }}</label>
          <input type="number" formControlName="followers" required>
          <div class="error-message" *ngIf="form.get('followers')?.hasError('required')">
            {{ 'ONBOARDING.REQUIRED_FIELD' | translate }}
          </div>
          <div class="error-message" *ngIf="form.get('followers')?.hasError('min')">
            {{ 'ONBOARDING.INVALID_FOLLOWERS' | translate }}
          </div>
        </div>
      </ng-container>

      <!-- Photos -->
      <div class="file-upload-section">
        <div class="upload-group">
          <label>{{ isBrand ? ('ONBOARDING.LOGO' | translate) : ('ONBOARDING.PHOTO' | translate) }}</label>
          <div class="upload-area" (click)="fileInput.click()">
            <input #fileInput type="file" (change)="onFileSelected($event, isBrand ? 'logo' : 'photo')" accept="image/*" style="display: none">
            <mat-icon class="upload-icon">cloud_upload</mat-icon>
            <p class="upload-text">{{ 'ONBOARDING.UPLOAD_FILE' | translate }}</p>
          </div>
          <img *ngIf="isBrand ? logoPreview : photoPreview" 
               [src]="isBrand ? logoPreview : photoPreview" 
               alt="Preview" 
               class="preview-image">
        </div>

        <div class="upload-group">
          <label>{{ 'ONBOARDING.PROFILE_PHOTO' | translate }}</label>
          <div class="upload-area" (click)="profilePhotoInput.click()">
            <input #profilePhotoInput type="file" (change)="onFileSelected($event, 'profilePhoto')" accept="image/*" style="display: none">
            <mat-icon class="upload-icon">cloud_upload</mat-icon>
            <p class="upload-text">{{ 'ONBOARDING.UPLOAD_FILE' | translate }}</p>
          </div>
          <img *ngIf="profilePhotoPreview" 
               [src]="profilePhotoPreview" 
               alt="Preview" 
               class="preview-image">
        </div>
      </div>

      <!-- Social Links -->
      <div class="social-links-section" *ngIf="!isBrand">
        <h2>{{ 'ONBOARDING.SOCIAL_LINKS' | translate }}</h2>
        <div formArrayName="socialLinks">
          <div *ngFor="let link of socialLinks.controls; let i = index" [formGroupName]="i" class="link-group">
            <select formControlName="platform" required>
              <option value="INSTAGRAM">Instagram</option>
              <option value="FACEBOOK">Facebook</option>
              <option value="TWITTER">Twitter</option>
              <option value="LINKEDIN">LinkedIn</option>
              <option value="YOUTUBE">YouTube</option>
              <option value="TIKTOK">TikTok</option>
            </select>

            <input type="url" formControlName="url" required placeholder="{{ 'ONBOARDING.URL' | translate }}">
            
            <button type="button" class="remove-button" (click)="removeSocialLink(i)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>

        <button type="button" class="add-button" (click)="addSocialLink()">
          <mat-icon>add</mat-icon>
          {{ 'ONBOARDING.ADD_SOCIAL_LINK' | translate }}
        </button>
      </div>

      <!-- Additional Links -->
      <div class="links-section">
        <h2>{{ 'ONBOARDING.ADDITIONAL_LINKS' | translate }}</h2>
        <div formArrayName="links">
          <div *ngFor="let link of links.controls; let i = index" [formGroupName]="i" class="link-group">
            <input type="text" formControlName="title" required placeholder="{{ 'ONBOARDING.LINK_TITLE' | translate }}">
            <input type="url" formControlName="url" required placeholder="{{ 'ONBOARDING.URL' | translate }}">
            <button type="button" class="remove-button" (click)="removeLink(i)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>

        <button type="button" class="add-button" (click)="addLink()">
          <mat-icon>add</mat-icon>
          {{ 'ONBOARDING.ADD_LINK' | translate }}
        </button>
      </div>

      <!-- Attachments Section -->
      <div class="file-upload-section">
        <h2>{{ 'ONBOARDING.ATTACHMENTS' | translate }}</h2>
        <div formArrayName="attachments">
          <div *ngFor="let attachment of attachments.controls; let i = index" [formGroupName]="i" class="upload-group">
            <div class="attachment-header">
              <input type="text" formControlName="title" required placeholder="{{ 'ONBOARDING.ATTACHMENT_TITLE' | translate }}">
              <textarea formControlName="description" placeholder="{{ 'ONBOARDING.ATTACHMENT_DESCRIPTION' | translate }}"></textarea>
              <select formControlName="mediaType" required>
                <option value="PHOTO">Photo</option>
                <option value="VIDEO">Video</option>
                <option value="DOCUMENT">Document</option>
              </select>
              <button type="button" class="remove-button" (click)="removeAttachment(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <div class="upload-area">
              <input #attachmentInputs type="file" [accept]="getAcceptType(i)" (change)="onAttachmentSelected($event, i)" style="display: none">
              <div class="upload-content" (click)="attachmentInputs.click()">
                <mat-icon class="upload-icon">cloud_upload</mat-icon>
                <p class="upload-text">{{ 'ONBOARDING.UPLOAD_FILE' | translate }}</p>
              </div>
            </div>
            <img *ngIf="attachment.get('preview')?.value" 
                 [src]="attachment.get('preview')?.value" 
                 alt="Preview" 
                 class="preview-image">
          </div>
        </div>
        <button type="button" class="add-button" (click)="addAttachment()">
          <mat-icon>add</mat-icon>
          {{ 'ONBOARDING.ADD_ATTACHMENT' | translate }}
        </button>
      </div>

      <button type="submit" class="submit-btn" [disabled]="form.invalid || isSubmitting">
        <span *ngIf="!isSubmitting">{{ 'ONBOARDING.SUBMIT' | translate }}</span>
        <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
      </button>
    </form>
  </div>
</div>
